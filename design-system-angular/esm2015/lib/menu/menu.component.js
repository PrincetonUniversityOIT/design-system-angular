import { Component, HostListener, Input } from '@angular/core';
import { ARIA_EXPANDED, HEADER_NAV_SELECTOR, HEADER_SUB_MENU_SELECTOR, ICON_CLOSE, ICON_MENU, ICON_SELECTOR, MENU_BUTTON_SELECTOR, MENU_HIDE_STYLE, MENU_NAV_EXPANDED_STYLE, MENU_RECENTLY_OPENED_ID, MENU_SELECTOR, MENU_STICKY_STYLE, MENU_SUB_NAV_EXPANDED_STYLE, MENUBAR_SHOWN_STYLE, MENUBAR_SUB_SHOWN_STYLE } from './menu-constants';
export class MenuComponent {
    constructor() { }
    onResize(event) {
        this.displayWindowSize();
    }
    displayWindowSize() {
        // Main Menu Reset
        document.querySelectorAll(HEADER_NAV_SELECTOR).forEach((header) => {
            header.classList.remove(MENU_NAV_EXPANDED_STYLE);
            header.querySelectorAll('ul').forEach((navbar) => {
                navbar.classList.remove(MENU_NAV_EXPANDED_STYLE);
                navbar.classList.remove(MENUBAR_SHOWN_STYLE);
                navbar.classList.remove(MENU_STICKY_STYLE);
                navbar.querySelectorAll('li').forEach((submenu) => {
                    submenu.classList.remove(MENU_STICKY_STYLE);
                    submenu.classList.remove(MENU_HIDE_STYLE);
                });
            });
        });
        document.querySelectorAll(MENU_BUTTON_SELECTOR).forEach((button) => {
            button.setAttribute(ARIA_EXPANDED, 'false');
            const menuToggleIcon = button.querySelector(ICON_SELECTOR);
            menuToggleIcon.classList.remove(ICON_CLOSE);
            menuToggleIcon.classList.add(ICON_MENU);
        });
        // Sub Menus Reset
        document.querySelectorAll(MENU_SELECTOR).forEach((menu) => {
            menu.querySelectorAll('ul').forEach((navbar) => {
                navbar.classList.remove(MENU_SUB_NAV_EXPANDED_STYLE);
                navbar.classList.remove(MENUBAR_SUB_SHOWN_STYLE);
            });
        });
        document.querySelectorAll(HEADER_SUB_MENU_SELECTOR).forEach((button) => {
            button.setAttribute(ARIA_EXPANDED, 'false');
        });
    }
    // This retrieves the appropriate button depending on the selector passed in
    getButtonForSelector(btnSelector, button, mainEl) {
        if (!button.matches(btnSelector)) {
            button = mainEl.querySelector(btnSelector);
        }
        return button;
    }
    closeSubMenus() {
        // const mainEl = event.btn.closest(MENU_MAIN_MENU_SELECTOR);
        document.querySelectorAll(HEADER_NAV_SELECTOR).forEach((mainEl) => {
            mainEl.querySelectorAll('li').forEach((navbar) => {
                navbar.querySelectorAll('ul').forEach((list) => {
                    list.classList.remove(MENU_STICKY_STYLE);
                    list.classList.add(MENU_HIDE_STYLE);
                });
            });
            // tslint:disable-next-line:no-shadowed-variable
            mainEl.querySelectorAll(HEADER_SUB_MENU_SELECTOR).forEach((button) => {
                button.setAttribute(ARIA_EXPANDED, 'false');
            });
        });
    }
    resetSubMenus() {
        document.querySelectorAll(HEADER_NAV_SELECTOR).forEach((mainEl) => {
            mainEl.querySelectorAll('li').forEach((navbar) => {
                navbar.querySelectorAll('ul').forEach((list) => {
                    list.classList.remove(MENU_STICKY_STYLE);
                    list.classList.remove(MENU_HIDE_STYLE);
                });
            });
        });
    }
    onMouseOut(event) {
        const li = event.target;
        if (li) {
            li.querySelectorAll('ul').forEach((subnav) => {
                if (subnav.id === MENU_RECENTLY_OPENED_ID) {
                    subnav.classList.remove(MENU_HIDE_STYLE);
                    subnav.id = '';
                }
            });
        }
    }
}
MenuComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'jazz-menu',
                template: "<nav aria-label=\"Main Menu\" class=\"jazz-menu__main-menu\">\n  <h2 class=\"jazz-visually-hidden\">Main Menu</h2>\n\n  <div class=\"jazz-container\">\n    <div class=\"jazz-menu__main-menu-navbar\">\n      <jazz-menu-main-button buttonClass=\"jazz-menu__menu-toggle\" [showCompact]=\"false\"></jazz-menu-main-button>\n      <div class=\"jazz-menu__nav-container\">\n        <ul *ngIf=\"menuItems && menuItems.length > 0\" class=\"jazz-menubar\" role=\"list\">\n            <li *ngFor=\"let level1item of menuItems\" (mouseleave)=\"onMouseOut($event)\">\n              <jazz-menu-item [menuItem]=\"level1item\" (closeSubMenus)=\"closeSubMenus()\" (resetSubMenus)=\"resetSubMenus()\"></jazz-menu-item>\n            </li>\n        </ul>\n        <div class=\"jazz-header__utility-menu jazz-header__utility-menu--hide-large\">\n          <ul *ngIf=\"utilityItems && utilityItems.length > 0\">\n            <li *ngFor=\"let utilityItem of utilityItems\" >\n              <a [routerLink]=\"utilityItem.url\" routerLinkActive=\"active\" #menuLink=\"routerLinkActive\"\n                [attr.aria-current]=\"menuLink.isActive ? 'page' : undefined\">{{utilityItem.label}}</a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</nav>\n"
            },] }
];
MenuComponent.ctorParameters = () => [];
MenuComponent.propDecorators = {
    menuItems: [{ type: Input }],
    utilityItems: [{ type: Input }],
    onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9kZXNpZ24tc3lzdGVtLWFuZ3VsYXIvc3JjL2xpYi9tZW51L21lbnUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM3RCxPQUFPLEVBQ0wsYUFBYSxFQUNiLG1CQUFtQixFQUFFLHdCQUF3QixFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLG9CQUFvQixFQUN6RyxlQUFlLEVBQ2YsdUJBQXVCLEVBQUUsdUJBQXVCLEVBQUUsYUFBYSxFQUMvRCxpQkFBaUIsRUFBRSwyQkFBMkIsRUFDOUMsbUJBQW1CLEVBQUUsdUJBQXVCLEVBQzdDLE1BQU0sa0JBQWtCLENBQUM7QUFVMUIsTUFBTSxPQUFPLGFBQWE7SUFheEIsZ0JBQWUsQ0FBQztJQUpoQixRQUFRLENBQUMsS0FBSztRQUNaLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFJRCxpQkFBaUI7UUFDZixrQkFBa0I7UUFDbEIsUUFBUSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7WUFDaEUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7Z0JBQy9DLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLHVCQUF1QixDQUFDLENBQUM7Z0JBQ2pELE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQzdDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFB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ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBIb3N0TGlzdGVuZXIsIElucHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFSSUFfRVhQQU5ERUQsXG4gIEhFQURFUl9OQVZfU0VMRUNUT1IsIEhFQURFUl9TVUJfTUVOVV9TRUxFQ1RPUiwgSUNPTl9DTE9TRSwgSUNPTl9NRU5VLCBJQ09OX1NFTEVDVE9SLCBNRU5VX0JVVFRPTl9TRUxFQ1RPUixcbiAgTUVOVV9ISURFX1NUWUxFLCBNRU5VX01BSU5fTUVOVV9TRUxFQ1RPUixcbiAgTUVOVV9OQVZfRVhQQU5ERURfU1RZTEUsIE1FTlVfUkVDRU5UTFlfT1BFTkVEX0lELCBNRU5VX1NFTEVDVE9SLFxuICBNRU5VX1NUSUNLWV9TVFlMRSwgTUVOVV9TVUJfTkFWX0VYUEFOREVEX1NUWUxFLFxuICBNRU5VQkFSX1NIT1dOX1NUWUxFLCBNRU5VQkFSX1NVQl9TSE9XTl9TVFlMRVxufSBmcm9tICcuL21lbnUtY29uc3RhbnRzJztcbmltcG9ydCB7TWFpbk1lbnVJdGVtQ29tcG9uZW50fSBmcm9tICcuLi9oZWFkZXIvbWFpbi1tZW51L21haW4tbWVudS1pdGVtJztcbmltcG9ydCB7VXRpbGl0eUl0ZW1Db21wb25lbnR9IGZyb20gJy4uL2hlYWRlci91dGlsaXR5LW1lbnUvdXRpbGl0eS1tZW51LWl0ZW0nO1xuXG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAnamF6ei1tZW51JyxcbiAgdGVtcGxhdGVVcmw6ICcuL21lbnUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIE1lbnVDb21wb25lbnQge1xuXG4gIEBJbnB1dCgpXG4gIG1lbnVJdGVtcz86IE1haW5NZW51SXRlbUNvbXBvbmVudFtdO1xuXG4gIEBJbnB1dCgpXG4gIHV0aWxpdHlJdGVtcz86IFV0aWxpdHlJdGVtQ29tcG9uZW50W107XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScsIFsnJGV2ZW50J10pXG4gIG9uUmVzaXplKGV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5kaXNwbGF5V2luZG93U2l6ZSgpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIGRpc3BsYXlXaW5kb3dTaXplKCk6IHZvaWQge1xuICAgIC8vIE1haW4gTWVudSBSZXNldFxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoSEVBREVSX05BVl9TRUxFQ1RPUikuZm9yRWFjaCgoaGVhZGVyKSA9PiB7XG4gICAgICBoZWFkZXIuY2xhc3NMaXN0LnJlbW92ZShNRU5VX05BVl9FWFBBTkRFRF9TVFlMRSk7XG4gICAgICBoZWFkZXIucXVlcnlTZWxlY3RvckFsbCgndWwnKS5mb3JFYWNoKChuYXZiYXIpID0+IHtcbiAgICAgICAgbmF2YmFyLmNsYXNzTGlzdC5yZW1vdmUoTUVOVV9OQVZfRVhQQU5ERURfU1RZTEUpO1xuICAgICAgICBuYXZiYXIuY2xhc3NMaXN0LnJlbW92ZShNRU5VQkFSX1NIT1dOX1NUWUxFKTtcbiAgICAgICAgbmF2YmFyLmNsYXNzTGlzdC5yZW1vdmUoTUVOVV9TVElDS1lfU1RZTEUpO1xuICAgICAgICBuYXZiYXIucXVlcnlTZWxlY3RvckFsbCgnbGknKS5mb3JFYWNoKChzdWJtZW51KSA9PiB7XG4gICAgICAgICAgc3VibWVudS5jbGFzc0xpc3QucmVtb3ZlKE1FTlVfU1RJQ0tZX1NUWUxFKTtcbiAgICAgICAgICBzdWJtZW51LmNsYXNzTGlzdC5yZW1vdmUoTUVOVV9ISURFX1NUWUxFKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoTUVOVV9CVVRUT05fU0VMRUNUT1IpLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZShBUklBX0VYUEFOREVELCAnZmFsc2UnKTtcbiAgICAgIGNvbnN0IG1lbnVUb2dnbGVJY29uID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoSUNPTl9TRUxFQ1RPUik7XG4gICAgICBtZW51VG9nZ2xlSWNvbi5jbGFzc0xpc3QucmVtb3ZlKElDT05fQ0xPU0UpO1xuICAgICAgbWVudVRvZ2dsZUljb24uY2xhc3NMaXN0LmFkZChJQ09OX01FTlUpO1xuICAgIH0pO1xuXG4gICAgLy8gU3ViIE1lbnVzIFJlc2V0XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChNRU5VX1NFTEVDVE9SKS5mb3JFYWNoKChtZW51KSA9PiB7XG4gICAgICBtZW51LnF1ZXJ5U2VsZWN0b3JBbGwoJ3VsJykuZm9yRWFjaCgobmF2YmFyKSA9PiB7XG4gICAgICAgIG5hdmJhci5jbGFzc0xpc3QucmVtb3ZlKE1FTlVfU1VCX05BVl9FWFBBTkRFRF9TVFlMRSk7XG4gICAgICAgIG5hdmJhci5jbGFzc0xpc3QucmVtb3ZlKE1FTlVCQVJfU1VCX1NIT1dOX1NUWUxFKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChIRUFERVJfU1VCX01FTlVfU0VMRUNUT1IpLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZShBUklBX0VYUEFOREVELCAnZmFsc2UnKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRoaXMgcmV0cmlldmVzIHRoZSBhcHByb3ByaWF0ZSBidXR0b24gZGVwZW5kaW5nIG9uIHRoZSBzZWxlY3RvciBwYXNzZWQgaW5cbiAgZ2V0QnV0dG9uRm9yU2VsZWN0b3IoYnRuU2VsZWN0b3IsIGJ1dHRvbiwgbWFpbkVsKTogYW55IHtcbiAgICBpZiAoIWJ1dHRvbi5tYXRjaGVzKGJ0blNlbGVjdG9yKSkge1xuICAgICAgYnV0dG9uID0gbWFpbkVsLnF1ZXJ5U2VsZWN0b3IoYnRuU2VsZWN0b3IpO1xuICAgIH1cbiAgICByZXR1cm4gYnV0dG9uO1xuICB9XG5cbiAgY2xvc2VTdWJNZW51cygpOiB2b2lkIHtcbiAgICAvLyBjb25zdCBtYWluRWwgPSBldmVudC5idG4uY2xvc2VzdChNRU5VX01BSU5fTUVOVV9TRUxFQ1RPUik7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChIRUFERVJfTkFWX1NFTEVDVE9SKS5mb3JFYWNoKChtYWluRWwpID0+IHtcbiAgICAgIG1haW5FbC5xdWVyeVNlbGVjdG9yQWxsKCdsaScpLmZvckVhY2goKG5hdmJhcikgPT4ge1xuICAgICAgICBuYXZiYXIucXVlcnlTZWxlY3RvckFsbCgndWwnKS5mb3JFYWNoKChsaXN0KSA9PiB7XG4gICAgICAgICAgbGlzdC5jbGFzc0xpc3QucmVtb3ZlKE1FTlVfU1RJQ0tZX1NUWUxFKTtcbiAgICAgICAgICBsaXN0LmNsYXNzTGlzdC5hZGQoTUVOVV9ISURFX1NUWUxFKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXNoYWRvd2VkLXZhcmlhYmxlXG4gICAgICBtYWluRWwucXVlcnlTZWxlY3RvckFsbChIRUFERVJfU1VCX01FTlVfU0VMRUNUT1IpLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKEFSSUFfRVhQQU5ERUQsICdmYWxzZScpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICByZXNldFN1Yk1lbnVzKCk6IHZvaWQge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoSEVBREVSX05BVl9TRUxFQ1RPUikuZm9yRWFjaCgobWFpbkVsKSA9PiB7XG4gICAgICBtYWluRWwucXVlcnlTZWxlY3RvckFsbCgnbGknKS5mb3JFYWNoKChuYXZiYXIpID0+IHtcbiAgICAgICAgbmF2YmFyLnF1ZXJ5U2VsZWN0b3JBbGwoJ3VsJykuZm9yRWFjaCgobGlzdCkgPT4ge1xuICAgICAgICAgIGxpc3QuY2xhc3NMaXN0LnJlbW92ZShNRU5VX1NUSUNLWV9TVFlMRSk7XG4gICAgICAgICAgbGlzdC5jbGFzc0xpc3QucmVtb3ZlKE1FTlVfSElERV9TVFlMRSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBvbk1vdXNlT3V0KGV2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgbGkgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgaWYgKGxpKSB7XG4gICAgICBsaS5xdWVyeVNlbGVjdG9yQWxsKCd1bCcpLmZvckVhY2goKHN1Ym5hdikgPT4ge1xuICAgICAgICBpZiAoc3VibmF2LmlkID09PSBNRU5VX1JFQ0VOVExZX09QRU5FRF9JRCkge1xuICAgICAgICAgIHN1Ym5hdi5jbGFzc0xpc3QucmVtb3ZlKE1FTlVfSElERV9TVFlMRSk7XG4gICAgICAgICAgc3VibmF2LmlkID0gJyc7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuIl19